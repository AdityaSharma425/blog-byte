<!DOCTYPE html>
<html lang="en">
<head>
    <%- include('./partials/head.ejs') %>
    <title>Blog</title>
</head>
<body>
    <%- include('./partials/nav.ejs') %>

    <div class="container2">
        
        <h1><%= blog.title %> /</h1><h6><%= blog.category %></h6>
        <img src="<%= blog.coverImageURL %>" class="blogcoverimg"/>
    
        <div class="paragraph2">
            <% blog.body.split('\n').forEach(paragraph => { %>
                <p class="mt-3"><%= paragraph %></p>
            <% }) %>
            <%= blog.createdAt.toLocaleDateString('en-US', { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' }) %>
        </div>
        

        
            <% if (locals.user && locals.user.email === blog.createdBy.email) { %>
                <a href="/blog/edit/<%= blog._id %>" class="editbtn">Edit</a>
                <a href="/blog/delete/<%= blog._id %>" class="deletebtn" onclick="if(!confirm('Are you sure you want to delete this blog?')) return false;">Delete</a>
            <% } else { %>
                <p style="color: red;">You do not have permission to edit or delete this blog.</p>
            <% } %>
        

        <div class="container9 mt-4">
            <b id="item">Published By:</b>
            <br>
            <img src="<%= blog.createdBy.profileImageUrl %>" width="50px" class="pfp" /> 
            <%= blog.createdBy.fullName %>
        </div>

        
    </div>

    
    
    

    <div class="container3 mt-3">
        <h1>Comments (<%= comments.length %>)</h1>
        <% if (locals.user) { %>
            <form action="/blog/comment/<%= blog._id %>" method="post">
                <div class="mb-3">
                  
                  <input
                    type="text"
                    name="content"
                    class="form-control"
                    placeholder="Enter your comment"/>
                  <button type="submit" class="btn btn-primary mt-2">Add</button>
                </div>
                </form>
                
        <% } %>
        <div class="comment mt-3">
            <% comments.forEach(comment => { %>
                <div>
                    <img src="<%= comment.createdBy.profileImageUrl %>" width="50px" class="pfp" /> 
                    <%= comment.createdBy.fullName %>
                    <pre><%= comment.content %></pre>

                </div>
        
            <% }) %>

        </div>
    </div>
    <%- include('./partials/footer.ejs') %>
    <%- include('./partials/scripts.ejs') %>

</body>
</html>